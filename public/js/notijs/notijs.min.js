(function(){angular.module("notijs",["notijs.controllers","notijs.directives","notijs.services"])})();
(function(){angular.module("notijs.controllers",[]).controller("NoticeController",["$scope","$rootScope","noticeService",function(a,e,c){var d=e.config.limit_latest,l=e.socket;a.notices=[];a.unread=0;a.seeAll=!1;var f=function(b){b=a.seeAll?null:b;c.getNotices(b).then(function(b){a.notices=b})};a.go=function(b){c.markAsRead(b).then(function(m){a.unread=m;b.url&&(window.location=b.url)})};a.seeAllNotices=function(){a.seeAll=!0;f()};a.seeLessNotices=function(){a.seeAll=!1;f(d)};a.markAllAsRead=function(){c.markAsRead().then(function(b){a.unread=
b})};a.markAsRead=function(b){c.markAsRead(b).then(function(b){a.unread=b})};a.deleteAll=function(){c["delete"]().then(function(b){a.unread=b;a.notices=[]})};a["delete"]=function(b){c["delete"](b).then(function(b){a.unread=b;f(d)})};f(d);(function(){c.getUnread().then(function(b){a.unread=b})})();(function(){l.on("notice",function(b){b=c.addNotice(b);a.notices=b.notices;a.unread=b.unread;a.$apply()})})()}]).controller("FlashController",["$scope","$rootScope","noticeService",function(a,e,c){var d=
e.socket;a.notice=!1;a.remove=function(){a.notice=!1};(function(){d.on("flashNotice",function(c){a.notice=c;a.$apply()})})()}])})();(function(){angular.module("notijs.directives",[]).directive("notices",function(){return{restrict:"E",templateUrl:"js/notijs/partials/notice.html"}})})();
(function(){angular.module("notijs.services",[]).factory("noticeService",["$rootScope","$http","$q",function(a,e,c){var d=NotiJSConfig;a.config=d;var l=io.connect(d.socket_url);l.emit("connection",{user_id:d.user_id});a.socket=l;var f=[],b=0;return{addNotice:function(a){f.unshift(a);b++;return{notices:f,unread:b}},getNotices:function(b){var a=c.defer(),g=d.api_url+"/notice/list/1";b&&(g+="/"+b);e.get(g).success(function(b){f=b.notices;a.resolve(f)});return a.promise},getUnread:function(){var a=c.defer();
e.get(d.api_url+"/notice/unread/1").success(function(c){b=c.unread;a.resolve(b)});return a.promise},markAsRead:function(a){var h=c.defer(),g=d.api_url+"/notice/read",k={user_id:"1"};void 0!==a?!1===a.read?(k.id=a.id,a.read=!0,b--,e.patch(g,{mark_as_read:k}).success(function(a){h.resolve(b)})):h.resolve(b):(b=0,e.patch(g,{mark_as_read:k}).success(function(a){f.forEach(function(a){a.read=!0});h.resolve(b)}));return h.promise},"delete":function(a){var h=c.defer(),g={user_id:"1"},k={method:"DELETE",url:d.api_url+
"/notice",data:{"delete":g},headers:{"Content-Type":"application/json;charset=utf-8"}};void 0!==a?(g.id=a.id,e(k).success(function(c){!1===a.read&&b--;h.resolve(b)})):(b=0,f=[],e(k).success(function(a){h.resolve(b)}));return h.promise}}}])})();